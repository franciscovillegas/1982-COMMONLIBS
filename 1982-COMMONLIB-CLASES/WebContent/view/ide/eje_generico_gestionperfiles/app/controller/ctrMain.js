/*
 * File: app/controller/ctrMain.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.ctrMain', {
    extend: 'Ext.app.Controller',

    AddPerfil: function(btn, text) {
        //inicio
        var perfil = text;
        var form = Ext.getCmp("frm_Perfiles").getForm();
        var error=false;
        form.submit({
            url:"../../../servlet/EjeCoreI?claseweb=cl.eje.view.sencha.Conf&modulo=eje_generico_gestionperfiles&accion=add&thing=TreePerfiles",
            method: "POST",
            params:	{ "perfil" : perfil },
            waitMsg	: 'Agregando Nuevo Perfil, espere por favor...',
            success	: function(form,result){
                try {
                    var data = Ext.JSON.decode(result.response.responseText);
                    if (data.success==="true" || data.success===true){
                        Ext.Msg.show({
                            title: 'Nuevo Perfil',
                            msg: 'El Perfil se creo correctamente.',
                            buttons: Ext.Msg.OK,
                            icon: Ext.Msg.INFO
                        });
                        Ext.getStore("js_Tree").load();
                        Ext.getStore("js_Colaborador").load();
                        Ext.getStore("js_Perfiles").removeAll();
                    }
                    else{
                        error=true;
                    }
                }
                catch(e){
                    error=true;
                }
                if (error===true){
                    var mensg='<p>Ha ocurido un error con algunos de los datos al tratar de grabar la informaci\u00f3n.</p> ';
                    mensg=mensg+'<p>Verifique los datos y por favor int\u00e9ntelo nuevamente.</p> ';
                    Ext.Msg.show({
                        title: 'Error inesperado',
                        msg: mensg,
                        buttons: Ext.Msg.OK,
                        icon: Ext.Msg.ERROR
                    });
                }
            },
            complete: function() {

            }
        });
        //fin aisgnacion perfiles
    }

});
