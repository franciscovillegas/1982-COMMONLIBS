/*
 * File: app/controller/ctrButton.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.ctrButton', {
    extend: 'Ext.app.Controller',

    control: {
        "#btn_desbloquear_intentos": {
            click: 'onButtonClick_Btn_desbloquear_intentos'
        },
        "#btn_desbloquear_nouso": {
            click: 'onButtonClick_Btn_desbloquear_nouso'
        },
        "#btn_refresh_intentos": {
            click: 'onButtonClick_Btn_resfresh_intentos'
        },
        "#btn_refresh_nouso": {
            click: 'onButtonClick_Btn_rfresh_nouso'
        }
    },

    onButtonClick_Btn_desbloquear_intentos: function(button, e, eOpts) {
        var error=false;
        var x = 0;
        var arrDesbloqueados = [];
        var panel = Ext.getCmp('grid_Bloqueos_intentos');
        var seleccionados=panel.getSelectionModel().getSelection();
        if(seleccionados.length>0){
            Ext.each(seleccionados, function(record, index, allRecords) {
                arrDesbloqueados.push({'rut': record.get('rut')});
            });
        }
        var form = Ext.getCmp('frm_Bloqueos');
        form.submit({
            url:'../../../servlet/EjeCoreI',
            method: 'POST',
            params:	{'claseweb'                 : 'cl.eje.view.sencha.Conf',
                     'accion'					: 'save',
                     'thing'					: 'BloqueoIntentos',
                     'modulo'					: 'eje_generico_desbloqueadorusuarios',
                     'desbloqueados'			: Ext.encode(arrDesbloqueados)
                    },

            waitMsg	: 'Generando su solicitudes de Desbloqueo...',
            success	: function(form,result){
                try {
                    var data = Ext.JSON.decode(result.response.responseText);
                    if (data.success===true){
                        Ext.Msg.show({
                            title: 'Resultado',
                            msg: 'La(s) Solicitud(es) de Desbloqueo por Intentos Fallidos se generaron con éxito',
                            buttons: Ext.Msg.OK //,
                            //icon: icon
                        });
                        Ext.getStore('jsGetBloqueosintentos').load();
                    }
                    else{
                        error=true;
                    }

                }
                catch(e){
                    error=true;
                }

                if (error===true){
                    Ext.Msg.show({
                        title: 'Resultado',
                        msg: 'La(s) Solicitud(es) de Desbloqueo por Intentos Fallidos no se procesaron...intentelo nuevamemte',
                        buttons: Ext.Msg.OK //,
                        //icon: icon
                    });
                }

            },
            complete: function() {
            }
        });
    },

    onButtonClick_Btn_desbloquear_nouso: function(button, e, eOpts) {
        var error=false;
        var x = 0;
        var arrDesbloqueados = [];
        var panel = Ext.getCmp('grid_Bloqueos_nouso');
        var seleccionados=panel.getSelectionModel().getSelection();
        if(seleccionados.length>0){
            Ext.each(seleccionados, function(record, index, allRecords) {
                arrDesbloqueados.push({'rut': record.get('rut')});
            });
        }
        var form = Ext.getCmp('frm_Bloqueos');
        form.submit({
            url:'../../../servlet/EjeCoreI',
            method: 'POST',
            params:	{'claseweb'                 : 'cl.eje.view.sencha.Conf',
                     'accion'					: 'save',
                     'thing'					: 'BloqueoNouso',
                     'modulo'					: 'eje_generico_desbloqueadorusuarios',
                     'desbloqueados'			: Ext.encode(arrDesbloqueados)
                    },

            waitMsg	: 'Generando su solicitudes de Desbloqueo...',
            success	: function(form,result){
                try {
                    var data = Ext.JSON.decode(result.response.responseText);
                    if (data.success===true){
                        Ext.Msg.show({
                            title: 'Resultado',
                            msg: 'La(s) Solicitud(es) de Desbloqueo por No Uso se generaron con éxito',
                            buttons: Ext.Msg.OK //,
                            //icon: icon
                        });
                        Ext.getStore('jsGetBloqueosnouso').load();
                    }
                    else{
                        error=true;
                    }

                }
                catch(e){
                    error=true;
                }

                if (error===true){
                    Ext.Msg.show({
                        title: 'Resultado',
                        msg: 'La(s) Solicitud(es) de Desbloqueo por No Uso no se procesaron...intentelo nuevamemte',
                        buttons: Ext.Msg.OK //,
                        //icon: icon
                    });
                }

            },
            complete: function() {
            }
        });
    },

    onButtonClick_Btn_resfresh_intentos: function(button, e, eOpts) {
        Ext.getStore('jsGetBloqueosintentos').load();
    },

    onButtonClick_Btn_rfresh_nouso: function(button, e, eOpts) {
        Ext.getStore('jsGetBloqueosnouso').load();
    }

});
