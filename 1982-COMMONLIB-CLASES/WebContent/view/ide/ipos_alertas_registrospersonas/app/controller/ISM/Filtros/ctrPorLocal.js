/*
 * File: app/controller/ISM/Filtros/ctrPorLocal.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.ISM.Filtros.ctrPorLocal', {
    extend: 'Ext.app.Controller',

    control: {
        "#tpnISM_PorLocal_Local": {
            itemclick: 'onTreepanelItemClick_PorLocal_Local'
        }
    },

    onTreepanelItemClick_PorLocal_Local: function(dataview, record, item, index, e, eOpts) {
        var strId = record.get('id');
        var bolAtivo = false;
        var strIcon = '../../images/btns/checkbox_null.png';

        if (record.get('activo')===false){
            strIcon = '../../images/btns/checkbox_add.png';
            bolAtivo = true;
        }

        record.set('icon', strIcon);
        record.set('activo', bolAtivo);

        treeNode = Ext.getCmp('tpnISM_PorLocal_Local').getRootNode();
        treeNode = treeNode.findChild('id',strId,true);
        treeNode.eachChild(
            function(node){
                node.set('icon', strIcon);
                node.set('activo', bolAtivo);
            }
        );

        this.fnEditarPersonas();
    },

    fnEditarPersonas: function() {
        var strLocales='';

        treeNode = Ext.getCmp('tpnISM_PorLocal_Local').getRootNode();
        treeNode.eachChild(
            function(node){
                node.eachChild(
                    function(chlnode){
                        var idlocal = chlnode.get('idlocal');
                        if (chlnode.get('activo')===true){
                            if (strLocales!=''){
                                strLocales=strLocales+',';
                            }
                            strLocales=strLocales+idlocal;
                        }
                    }
                );
            }
        );

        if (strLocales===''){
            strLocales='0';
        }

        Ext.apply(Ext.getStore('ISM.PorLocal.jsGetPersonas').getProxy().extraParams, {locales: strLocales});
        Ext.getStore('ISM.PorLocal.jsGetPersonas').load();
    }

});
